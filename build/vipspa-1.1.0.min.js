!function(){function t(){}function e(t){if(""===t)return!1;var e=t.substr(1),n=e.indexOf("?"),o={},a="";if(n>-1){var i=e.split("?");a=i[0];var u=i[1];o=r(u)}else a=e,o={};var p=a.split("/");return{path:a,routers:p,param:o}}function r(t){var e=t.split("&"),r={};return e.forEach(function(t){var e,n,o=t.split("=");e=o[0],n=o[1],""!==e&&(r[e]=decodeURIComponent(n))}),r}function n(t){var e=(t.path,t.routers);t.param;if(1===e.length){m=t;var r=e[0],n=vipspa.routerMap[r];if("undefined"==typeof n)return console.error("路由匹配失败，请检查。",t),!1;a(vipspa.mainView,n)}else if(2===e.length){var i=!0;null===m?m=t:(i=m[0]!==t[0],m=t);var r=e[0],u=e[1],n=vipspa.routerMap[r];if("undefined"==typeof n)return console.error("路由匹配失败，请检查。",t),!1;var p=n.subView,c=n.children,s=o(c,u);if("undefined"==typeof n)return console.error("子路由匹配失败，请检查。",t),!1;i?a(vipspa.mainView,n,function(){a(p,s)}):a(p,s)}}function o(t,e){var r=null;return t.forEach(function(t){t.name===e&&(r=t)}),r}function a(t,e,r){var n=l(e.templateUrl);n?p(t,e,r):u(t,e,r)}function i(t,e,r){$.ajax({type:"GET",url:t,dataType:"html",success:function(t,r,n){e&&e(t)},error:function(t,e,n){if(r&&r(),0===$(vipspa.errorTemplateId).length)return!1;var o=$(vipspa.errorTemplateId).html();o=o.replace(/{{errStatus}}/,t.status),o=o.replace(/{{errContent}}/,t.responseText),$(vipspa.mainView).html(o)}})}function u(t,e,r){i(e.templateUrl,function(n){$(t).html(n),v(e.controller),s(e.templateUrl,n),r&&r()})}function p(t,e,r){var n=c(e.templateUrl);$(t).html(n),v(e.controller),r&&r()}function c(t){for(var e,r=0;r<vipspa.catchHtmls.length;r++)if(e=vipspa.catchHtmls[r],e.routerUrl===t)return e.htmls;return""}function s(t,e){var r={routerUrl:t,htmls:e};vipspa.catchHtmls.push(r)}function l(t){for(var e,r=0;r<vipspa.catchHtmls.length;r++)if(e=vipspa.catchHtmls[r],e.routerUrl===t)return!0;return!1}function f(){var t=location.hash,e=vipspa.parse(t);n(e)}function v(t,e){var r,n=document.createElement("script");n.setAttribute("src",t),n.onreadystatechange=n.onload=function(){n.onreadystatechange=null,document.documentElement.removeChild(n),n=null,r||"function"==typeof e&&e(),r=!0},document.documentElement.appendChild(n)}t.prototype.start=function(t){var e=this;e.routerMap=t.router,e.mainView=t.view,e.errorTemplateId=t.errorTemplateId,e.catchHtmls=[],f(),window.onhashchange=function(){f()}};var h=[],m=null;t.prototype.getMessage=function(t){var e={};return $.each(h,function(r,n){n.id===t&&(e=n)}),e},t.prototype.setMessage=function(t){var e=JSON.parse(JSON.stringify(t));$.each(h,function(t,r){if(r.id===e.id)return r=e,!1}),h.push(e)},t.prototype.delMessage=function(t){if("undefined"==typeof t)return!1;var e=0;$.each(h,function(r,n){n.id===t&&(e=r)}),$.each(h,function(t,r){t>e&&(h[t-1]=r)})},t.prototype.clearMessage=function(t){h=[]},t.prototype.stringify=function(t,e){var r,n="";for(var o in e)n+=o+"="+encodeURIComponent(e[o])+"&";return""===n?r=t:(n=n.substring(0,n.length-1),r=t+"?"+n),r},t.prototype.parse=function(t){var r="undefined"==typeof t?location.hash:t,n=e(r);return n},window.vipspa=new t}();